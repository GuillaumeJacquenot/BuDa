<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Supervision</title>
    <link rel="stylesheet" href="graphTool.css">
    <link rel="stylesheet" href="cytostylesheet.css">

    <script src="js/jquery-2.2.4.min.js"></script>
		<script src="./js/cytoscape.js"></script>
    <script src="./js/cytoutils.js"></script>
    <script src="./js/dagre.js"></script>
		<script src="./js/cytoscape-dagre.js"></script>
    <script src="./js/download.js"></script>
    <script src="./js/loadFile.js"></script>

    <script type="text/javascript" src="elm.js"></script>
  </head>
  <body>
    <div id="elm-app"></div>
    <div id="cy"></div>

    <script type="text/javascript">
      var div = document.getElementById('elm-app');
      var app = Elm.Main.embed(div);


      app.ports.layout.subscribe(function(word) {
        _layout_dagre();
      });

      app.ports.sendDataPBSModel.subscribe(function(word) {
        var obj = JSON.parse(word);
        _sendDataModel_(obj);
        setPBSStyle();
        _layout_dagre();
      });

      app.ports.sendDataBullesModel.subscribe(function(word) {
        var obj = JSON.parse(word);
        _sendDataModel_(obj);
        setBullesStyle();
        _layout_dagre();
      });

      app.ports.sendParentSelection.subscribe(function(word) {
        var obj = JSON.parse(word);
        if (obj != null)
        {
          cy.$('#' + obj ).select();
        }
      });

      app.ports.saveModel.subscribe(function(word) {
        var obj = JSON.parse(word);
        var filename = obj.filename;
        var model = obj.model;
        download( JSON.stringify ( model ), filename, "text/plain");
      });

      app.ports.exportLNK.subscribe(function(word) {
        var obj = JSON.parse(word);
        var filename = obj.filename;
        var model = obj.model;
        console.log (model);
        download(model, filename, "text/plain");
      });

      app.ports.loadModel.subscribe(function(word) {
        var msg = loadModelFromFile(word);
        // console.log('loadmodel:' + msg);
      });

      function app_port_sendSelectionToElm (msg) {
        app.ports.selection.send(msg);
      }

      function app_port_sendModelToElm (msg) {
        app.ports.modeltoelm.send(msg);
      }

      function app_port_sendDoubleClickToElm (msg) {
        app.ports.doubleclick.send(msg);
      }

    </script>
  </body>
</html>
